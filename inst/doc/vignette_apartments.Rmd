---
title: "Example with random forest model"
author: "Anna Kozak"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Example with random forest model}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Example with random forest regression model

In this vignette we present measure for random forest regression model.


```{r, include=FALSE, warning=FALSE, error=FALSE, message=FALSE}
library("dplyr")
library("ggplot2")
```
### 1 Dataset

We work on Apartments dataset from `DALEX` package.

```{r, warning = FALSE, echo = FALSE, message = FALSE, include = TRUE}
library("DALEX")
data(apartments)
head(apartments)
```

### 2 Random forest regression model

Now, we define a random forest regression model and use explain from `DALEX`.

```{r, warning = FALSE, error = FALSE, message = FALSE, include = TRUE}
library("randomForest")
apartments_rf_model <- randomForest(m2.price ~ construction.year + surface + floor +
                                      no.rooms, data = apartments)
explainer_rf <- explain(apartments_rf_model,
                        data = apartmentsTest[,2:5], y = apartmentsTest$m2.price)
```


### 3 New observation

We need to specify an observation. Let consider a new apartment with following attributes. Moreover, we calculate predict value for this new observation.

```{r, warning = FALSE, error = FALSE, message = FALSE, include = TRUE}
new_apartment <- data.frame(construction.year = 1998, surface = 88, floor = 2L, no.rooms = 3)
predict(apartments_rf_model, new_apartment)
```

### 4 Calculate Ceteris Paribus profiles

Let see the Ceteris Paribus Plots calculated with `ceteris_paribus()` function.

```{r, warning = FALSE, error = FALSE, message = FALSE, include = TRUE}
library("ingredients")
profiles <- ingredients::ceteris_paribus(explainer_rf, new_apartment)
plot(profiles) + show_observations(profiles)
```

### 5 Calculate measure of local variable importance

Now, we calculated a measure of local variable importance via oscillation based on Ceteris Paribus plot. We use variant with all parameters equals to TRUE.

```{r, warning = FALSE, error = FALSE, message = FALSE, include = TRUE}
library("vivo")
measure <- local_variable_importance(profiles, apartments[,2:5], absolute_deviation = TRUE, point = TRUE, density = TRUE)
```

```{r, warning = FALSE, error = FALSE, message = FALSE, include = TRUE}
plot(measure)
```



For the new observation the most important variable is surface, then floor, construction.year and no.rooms.
